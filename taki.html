<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>TAKI MASTER - ONLINE</title>
    <style>
        :root { --gold: #d4af37; --red: #e74c3c; }
        body { 
            margin: 0; background: #1a1a1a; color: white; font-family: sans-serif;
            display: flex; height: 100vh; flex-direction: column;
        }
        /* ××¡×š ×›× ×™×¡×” */
        #login-screen {
            position: fixed; inset: 0; background: black; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        /* ××‘× ×” ×¨××©×™ */
        #game-container { display: none; flex: 1; display: flex; }
        #sidebar { width: 250px; background: #222; border-left: 2px solid var(--gold); display: flex; flex-direction: column; }
        #main-board { flex: 1; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* ×¦'××˜ */
        #chat-box { flex: 1; overflow-y: auto; padding: 10px; font-size: 14px; }
        .msg { margin-bottom: 8px; padding: 5px; border-radius: 5px; background: #333; }
        .msg.private { border: 1px solid var(--gold); color: var(--gold); }
        
        /* ×©×—×§× ×™× */
        .player-item { padding: 10px; border-bottom: 1px solid #444; cursor: pointer; }
        .player-item:hover { background: #333; }
        .hp-bar { color: #ff4d4d; font-weight: bold; font-size: 12px; }

        input, button { padding: 10px; margin: 5px; border-radius: 5px; border: none; }
        .btn-gold { background: var(--gold); color: black; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="login-screen">
    <h1 style="color: var(--gold);">TAKI MASTER</h1>
    <input type="text" id="username" placeholder="×”×›× ×¡ ×©× ×©×—×§×Ÿ...">
    <button class="btn-gold" onclick="joinGame()">×”×ª×—×œ ×œ×©×—×§</button>
</div>

<div id="game-container" style="display: none;">
    <div id="sidebar">
        <div style="padding: 10px; background: #333;"><b>×©×—×§× ×™× (×œ×—×¥ ×œ×œ×—×™×©×”)</b></div>
        <div id="player-list"></div>
        <div id="chat-box"></div>
        <div style="display: flex; padding: 5px;">
            <input type="text" id="chat-input" placeholder="×”×•×“×¢×”..." style="flex: 1;">
            <button class="btn-gold" onclick="sendMsg()">×©×œ×—</button>
        </div>
    </div>
    
    <div id="main-board">
        <div id="turn-indicator" style="font-size: 24px; color: var(--gold); margin-bottom: 20px;">××—×›×” ×œ×©×—×§× ×™×...</div>
        <div style="display: flex; gap: 20px;">
            <div id="deck" style="width: 100px; height: 150px; background: #444; border: 3px solid white; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer;">×§×•×¤×”</div>
            <div id="pile" style="width: 100px; height: 150px; background: white; border: 3px solid #e74c3c; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: black; font-weight: bold; font-size: 30px;">8</div>
        </div>
        <div id="my-hand" style="margin-top: 50px; display: flex; gap: 10px;">
            </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, onDisconnect } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDTcYiOhazu3kfn5YhjAnjDBCJMyGaqvA4",
        authDomain: "takimaster-39f6c.firebaseapp.com",
        databaseURL: "https://takimaster-39f6c-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "takimaster-39f6c",
        storageBucket: "takimaster-39f6c.firebasestorage.app",
        messagingSenderId: "6879693086",
        appId: "1:6879693086:web:298b7f22fe662a2148210f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let myId, myName, privateTargetId = null;

    window.joinGame = () => {
        myName = document.getElementById('username').value;
        if(!myName) return alert("×”×›× ×¡ ×©×!");

        const pRef = push(ref(db, 'players'));
        myId = pRef.key;
        onDisconnect(pRef).remove();

        set(pRef, { id: myId, name: myName, hp: 100 });

        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('game-container').style.display = 'flex';
        startSync();
    };

    function startSync() {
        // ×¡× ×›×¨×•×Ÿ ×©×—×§× ×™× ×•×“×
        onValue(ref(db, 'players'), (snap) => {
            const players = snap.val();
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            for(let id in players) {
                const p = players[id];
                const item = document.createElement('div');
                item.className = 'player-item';
                item.innerHTML = `<div>${p.name}</div><div class="hp-bar">â¤ï¸ ${p.hp} HP</div>`;
                item.onclick = () => {
                    privateTargetId = id;
                    alert("×œ×•×—×© ×œ: " + p.name);
                };
                list.appendChild(item);
            }
        });

        // ×¡× ×›×¨×•×Ÿ ×¦'××˜
        onValue(ref(db, 'chat'), (snap) => {
            const msgs = snap.val();
            const box = document.getElementById('chat-box');
            box.innerHTML = '';
            for(let id in msgs) {
                const m = msgs[id];
                if(!m.target || m.target === myId || m.senderId === myId) {
                    const div = document.createElement('div');
                    div.className = 'msg' + (m.target ? ' private' : '');
                    div.innerHTML = `<b>${m.target ? 'ğŸ”’ ' : ''}${m.sender}:</b> ${m.text}`;
                    box.appendChild(div);
                }
            }
            box.scrollTop = box.scrollHeight;
        });
    }

    window.sendMsg = () => {
        const input = document.getElementById('chat-input');
        if(!input.value) return;
        push(ref(db, 'chat'), {
            sender: myName,
            senderId: myId,
            text: input.value,
            target: privateTargetId
        });
        input.value = '';
        privateTargetId = null;
    };
</script>
</body>
</html>
