<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TAKI MASTER PRO</title>
    <style>
        :root { --gold: #d4af37; --red: #e74c3c; --blue: #3498db; --green: #2ecc71; --yellow: #f1c40f; }
        body { 
            margin: 0; background: #121212; color: white; font-family: sans-serif; 
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }
        
        /* ××¡×š ×›× ×™×¡×” */
        #login-screen {
            position: fixed; inset: 0; background: #000; z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* ×œ×•×— ××©×—×§ ××•×ª×× ×œ× ×™×™×“ */
        #game-ui { display: none; flex: 1; flex-direction: column; }
        #main-area { flex: 2; display: flex; flex-direction: column; align-items: center; justify-content: space-around; position: relative; }
        
        /* ××–×•×¨ ×”×©×—×§× ×™× */
        #players-top { display: flex; justify-content: center; gap: 10px; width: 100%; padding: 5px; background: rgba(0,0,0,0.3); }
        .player-status { font-size: 12px; padding: 5px; border-radius: 5px; border: 1px solid #444; }
        .active-turn { border-color: var(--gold); box-shadow: 0 0 10px var(--gold); }

        /* ×§×œ×¤×™× */
        .card { 
            width: 55px; height: 85px; border: 2px solid white; border-radius: 6px; 
            display: inline-flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 14px; cursor: pointer; position: relative;
        }
        @media (min-width: 600px) { .card { width: 75px; height: 110px; font-size: 18px; } }

        .card.red { background: var(--red); }
        .card.blue { background: var(--blue); }
        .card.green { background: var(--green); }
        .card.yellow { background: var(--yellow); }
        .card.special { background: #333; color: var(--gold); border-color: var(--gold); }

        /* ×¦'××˜ ×ª×—×ª×•×Ÿ ×œ× ×™×™×“ */
        #sidebar { height: 180px; background: #1a1a1a; border-top: 2px solid var(--gold); display: flex; flex-direction: column; }
        #chat-box { flex: 1; overflow-y: auto; padding: 5px; font-size: 13px; text-align: right; }
        .msg-input-area { display: flex; padding: 5px; gap: 5px; }

        #my-hand { 
            display: flex; overflow-x: auto; width: 100%; padding: 10px; 
            gap: 5px; background: rgba(255,255,255,0.05); min-height: 110px;
        }
        .btn-gold { background: var(--gold); color: black; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div id="login-screen">
    <h1 style="color: var(--gold);">TAKI MASTER</h1>
    <input type="text" id="username" placeholder="×©× ×©×—×§×Ÿ..." style="padding: 10px; border-radius: 20px; border: none; width: 200px;">
    <button class="btn-gold" onclick="joinGame()" style="margin-top: 15px; width: 220px;">×”×ª×—×‘×¨</button>
</div>

<div id="game-ui">
    <div id="players-top"></div>
    
    <div id="main-area">
        <div id="status-text" style="color: var(--gold); font-size: 14px;">×××ª×™×Ÿ ×œ×©×—×§× ×™×...</div>
        <div style="display: flex; gap: 20px;">
            <div id="deck" class="card special" onclick="drawCard()">×§×•×¤×”</div>
            <div id="pile"></div>
        </div>
        <div id="my-hand"></div>
    </div>

    <div id="sidebar">
        <div id="chat-box"></div>
        <div class="msg-input-area">
            <input type="text" id="chat-input" placeholder="×›×ª×•×‘ ×”×•×“×¢×”..." style="flex: 1; border-radius: 5px; border: none; padding: 5px;">
            <button class="btn-gold" onclick="sendMsg()">×©×œ×—</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, onDisconnect, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDTcYiOhazu3kfn5YhjAnjDBCJMyGaqvA4",
        authDomain: "takimaster-39f6c.firebaseapp.com",
        databaseURL: "https://takimaster-39f6c-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "takimaster-39f6c",
        storageBucket: "takimaster-39f6c.firebasestorage.app",
        messagingSenderId: "6879693086",
        appId: "1:6879693086:web:298b7f22fe662a2148210f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let myId, myName, privateId = null;

    // ×¤×•× ×§×¦×™×™×ª ×©×œ×™×—×ª ×”×•×“×¢×” ×‘×× ×ª×¨
    document.getElementById('chat-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMsg();
    });

    window.joinGame = () => {
        myName = document.getElementById('username').value;
        if(!myName) return;
        const pRef = push(ref(db, 'players'));
        myId = pRef.key;
        onDisconnect(pRef).remove();
        set(pRef, { id: myId, name: myName, hp: 100, online: true });
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        initSync();
    };

    function initSync() {
        // ×¡× ×›×¨×•×Ÿ ×©×—×§× ×™×
        onValue(ref(db, 'players'), (snap) => {
            const players = snap.val();
            const container = document.getElementById('players-top');
            container.innerHTML = '';
            for(let id in players) {
                const p = players[id];
                container.innerHTML += `<div class="player-status" onclick="setPrivate('${id}')">
                    ${p.name} <span style="color:red">â¤${p.hp}</span>
                </div>`;
            }
        });

        // ×¡× ×›×¨×•×Ÿ ×¦'××˜
        onValue(ref(db, 'chat'), (snap) => {
            const box = document.getElementById('chat-box');
            box.innerHTML = '';
            const msgs = snap.val();
            for(let id in msgs) {
                const m = msgs[id];
                if(!m.target || m.target === myId || m.senderId === myId) {
                    box.innerHTML += `<div><b>${m.target ? 'ğŸ”’ ' : ''}${m.sender}:</b> ${m.text}</div>`;
                }
            }
            box.scrollTop = box.scrollHeight;
        });
    }

    window.sendMsg = () => {
        const input = document.getElementById('chat-input');
        if(!input.value) return;
        push(ref(db, 'chat'), { sender: myName, senderId: myId, text: input.value, target: privateId });
        input.value = ''; privateId = null;
    };

    window.setPrivate = (id) => { privateId = id; alert("×œ×—×™×©×” ×¤×¨×˜×™×ª ×”×•×¤×¢×œ×”"); };
    
    // ×›××Ÿ ×ª×‘×•× ×œ×•×’×™×§×ª ×”×˜××§×™ ×”××œ××” ×‘×©×œ×‘ ×”×‘× (Shuffle, Turns, Rules)
</script>
</body>
</html>
