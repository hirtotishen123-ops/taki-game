<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAKI TEST</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #0a2e12; color: white; font-family: sans-serif; text-align: center; margin: 0; padding: 20px; }
        .box { border: 2px solid gold; padding: 20px; border-radius: 15px; background: rgba(0,0,0,0.5); max-width: 400px; margin: auto; }
        input { padding: 10px; width: 80%; margin: 10px; border-radius: 5px; }
        button { padding: 10px 20px; background: gold; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
        #chat { height: 150px; overflow-y: auto; border: 1px solid #444; margin: 10px; padding: 5px; background: #111; text-align: right; }
        #admin-panel { display: none; margin-top: 20px; border-top: 2px dashed red; padding-top: 10px; }
    </style>
</head>
<body>

    <h1>TAKI MASTER ELITE</h1>
    
    <div id="login" class="box">
        <input type="text" id="nameInp" placeholder="שם שחקן (או 'מנהל')">
        <button onclick="start()">היכנס למשחק</button>
    </div>

    <div id="game" class="box" style="display:none;">
        <h3>שלום, <span id="myName"></span></h3>
        <div id="chat"></div>
        <input type="text" id="msgInp" placeholder="הודעה ואז אנטר">
        
        <div id="admin-panel">
            <p style="color:red;">לוח מנהל</p>
            <button onclick="resetGame()" style="background:red; color:white;">איפוס וסגירת חדר</button>
        </div>
    </div>

<script>
    const config = {
        apiKey: "AIzaSyDTcYiOhazu3kfn5YhjAnjDBCJMyGaqvA4",
        authDomain: "takimaster-39f6c.firebaseapp.com",
        databaseURL: "https://takimaster-39f6c-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "takimaster-39f6c",
        storageBucket: "takimaster-39f6c.firebasestorage.app",
        messagingSenderId: "6879693086",
        appId: "1:6879693086:web:298b7f22fe662a2148210f"
    };

    firebase.initializeApp(config);
    const db = firebase.database();
    let user = "";

    function start() {
        let val = document.getElementById('nameInp').value;
        if(!val) return;

        if(val === "מנהל") {
            user = prompt("איך תרצה שיראו אותך?") || "המנהל";
            document.getElementById('admin-panel').style.display = 'block';
        } else {
            user = val;
        }

        document.getElementById('login').style.display = 'none';
        document.getElementById('game').style.display = 'block';
        document.getElementById('myName').innerText = user;

        // חיבור לצאט
        db.ref('chat').on('value', (snap) => {
            const box = document.getElementById('chat');
            box.innerHTML = '';
            snap.forEach(m => {
                box.innerHTML += `<div><b>${m.val().user}:</b> ${m.val().text}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    // שליחה ב-Enter
    document.getElementById('msgInp').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') {
            db.ref('chat').push({ user: user, text: e.target.value });
            e.target.value = '';
        }
    });

    function resetGame() {
        if(confirm("לאפס הכל?")) {
            db.ref('/').remove();
            location.reload();
        }
    }
</script>
</body>
</html>
